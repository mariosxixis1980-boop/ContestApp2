<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Locked</title>
  <style>
    body{font-family:system-ui,Segoe UI,Arial;display:flex;min-height:100vh;align-items:center;justify-content:center;background:#0b1220;color:#eaf1ff}
    .card{max-width:560px;width:92%;background:#101a30;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:22px;box-shadow:0 12px 40px rgba(0,0,0,.35)}
    .warn{background:rgba(255,196,0,.12);border:1px solid rgba(255,196,0,.35);padding:10px 12px;border-radius:12px;margin-top:12px}
    button{margin-top:14px;width:100%;padding:10px 12px;border-radius:10px;border:0;background:#2f7dff;color:white;font-weight:700;cursor:pointer}
    a{color:#8cc0ff}
    .muted{opacity:.8;font-size:13px}
  </style>
</head>
<body>
  <div class="card">
    <h2>Locking</h2>
    <div id="box" class="warn">Έλεγχος πρόσβασης…</div>
    <button id="btnLogout" type="button">Sign out</button>
    <p class="muted" style="margin-top:10px">Πήγαινε: <a href="login.html">login</a></p>
  </div>

  <script type="module">
    import { getCurrentUser, getProfileById, signOutSafe } from './supabase.js';

    const box = document.getElementById('box');
    const btnLogout = document.getElementById('btnLogout');

    function setText(t){ box.textContent = t; }

    async function run() {
      try {
        const user = await getCurrentUser();
        if (!user) {
          setText('Δεν είσαι logged in. Πήγαινε στο login.');
          return;
        }

        const profile = await getProfileById(user.id);
        if (profile?.is_admin === true) {
          // admin -> go dashboard
          window.location.href = 'dashboard.html';
          return;
        }

        setText(`Δεν έχεις admin πρόσβαση (${user.email}). Αν πρέπει να είσαι admin, βεβαιώσου ότι υπάρχει row στο public.profiles με id = auth.users.id και is_admin = true.`);

      } catch (e) {
        console.error(e);
        setText('Σφάλμα στον έλεγχο. Δες Console για λεπτομέρειες.');
      }
    }

    btnLogout.addEventListener('click', async () => {
      await signOutSafe();
      window.location.href = 'login.html';
    });

    run();
  </script>
</body>
</html>
