<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Cyprus Match Predict</title>
  <style>
    :root{
      --bg:#070b13;--b:rgba(255,255,255,.12);
      --t:#eaf1ff;--m:rgba(255,255,255,.65);
      --g:rgba(46,204,113,.20);--gb:rgba(46,204,113,.45);
      --a:rgba(241,196,15,.16);--ab:rgba(241,196,15,.45);
      --r:rgba(231,76,60,.14);--rb:rgba(231,76,60,.45);
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    body{
      margin:0;min-height:100vh;padding:18px;color:var(--t);
      background:
        radial-gradient(900px 700px at 20% 0%, rgba(40,110,255,.25), transparent 55%),
        radial-gradient(900px 700px at 80% 10%, rgba(0,255,170,.18), transparent 55%),
        var(--bg);
      display:flex;align-items:center;justify-content:center;
    }
    .card{
      width:min(520px, 100%);
      border:1px solid var(--b);
      border-radius:22px;
      padding:16px;
      background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      box-shadow:0 18px 60px rgba(0,0,0,.55);
    }
    h1{margin:0;font-size:36px}
    .sub{margin-top:6px;color:var(--m);font-weight:700}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
    .pill{
      padding:8px 12px;border:1px solid var(--b);border-radius:999px;
      background:rgba(0,0,0,.25);font-weight:800
    }
    .btn{
      border:1px solid var(--b);background:rgba(255,255,255,.06);color:var(--t);
      padding:10px 12px;border-radius:14px;font-weight:900;cursor:pointer;
      text-decoration:none;display:inline-flex;align-items:center;justify-content:center;gap:8px;
    }
    .g{background:var(--g);border-color:var(--gb)}
    .a{background:var(--a);border-color:var(--ab)}
    .r{background:var(--r);border-color:var(--rb)}
    .box{
      border:1px solid var(--b);border-radius:18px;background:rgba(0,0,0,.18);
      padding:12px;margin-top:12px;
    }
    label{display:block;margin-top:10px;color:var(--m);font-weight:800}
    input{
      width:100%;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--b);
      background:rgba(0,0,0,.25);
      color:var(--t);
      outline:none;
      font-weight:800;
    }
    .mini{color:var(--m);font-weight:750;margin-top:8px}
    .tabs{display:flex;gap:10px;margin-top:12px}
    .tab{flex:1}
    .hide{display:none}
    #toast{
      display:none;position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
      z-index:9999;
    }
  </style>
  </head>
  
  <body>
    <div class="card">
<div style="text-align:center;margin-bottom:12px;">
    <div style="font-size:18px;font-weight:700;">
        Cyprus Match Predict
    </div>
    <div style="font-size:13px;color:#C9A24D;letter-spacing:2px;margin-top:4px;">
     ğŸ‡¨ğŸ‡¾  C.M.P ğŸ‡¨ğŸ‡¾
    </div>
</div>
    
    <h1>ğŸ” Login</h1>
    <div class="sub">Î’Î¬Î»Îµ username & password. Email (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ) Î¼ÏŒÎ½Î¿ ÏƒÏ„Î·Î½ ÎµÎ³Î³ÏÎ±Ï†Î®.</div>
    
    <!-- âœ… ÎÎ•ÎŸ: Next contest preview -->
    <div class="box" id="nextBox">
      <div class="mini" style="font-size:16px;font-weight:900">
        ğŸ“… <span id="nextText">Î•Ï€ÏŒÎ¼ÎµÎ½Î¿Ï‚ Î´Î¹Î±Î³Ï‰Î½Î¹ÏƒÎ¼ÏŒÏ‚: -</span>
      </div>
      <div class="mini" id="nextSub" style="margin-top:6px;opacity:.95">-</div>
    </div>

    <div class="tabs">
      <button class="btn a tab" id="tabLogin" type="button">Î•Î¯ÏƒÎ¿Î´Î¿Ï‚</button>
      <button class="btn tab" id="tabRegister" type="button">Î•Î³Î³ÏÎ±Ï†Î®</button>
    </div>

    <!-- LOGIN -->
    <div class="box" id="loginBox">
      <label>Username</label>
      <input id="loginUser" autocomplete="username" placeholder="Ï€.Ï‡ marios"/>

      <label>Password</label>
      <input id="loginPass" type="password" autocomplete="current-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/>

      <div class="row">
        <button class="btn g" id="btnLogin" type="button">Login</button>
        <button class="btn" id="clearBtn" type="button">ğŸ§½ Clear</button>
      </div>

      <div class="mini">Tip: Î‘Î½ Î²Î»Î­Ï€ÎµÎ¹Ï‚ â€œÎºÏ‰Î´Î¹ÎºÏŒ Î¼ÏŒÎ½Î¿Ï‚ Ï„Î¿Ï…â€, ÎµÎ¯Î½Î±Î¹ autofill Ï„Î¿Ï… Chrome.</div>
    </div>

    <!-- REGISTER -->
    <div class="box hide" id="registerBox">
      <label>Username</label>
      <input id="regUser" autocomplete="username" placeholder="Î´Î¹Î¬Î»ÎµÎ¾Îµ username"/>

      <label>Password</label>
      <input id="regPass" type="password" autocomplete="new-password" placeholder="Î´Î¹Î¬Î»ÎµÎ¾Îµ password"/>

      <label>Email (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)</label>
      <input id="regEmail" type="email" autocomplete="email" placeholder="Ï€.Ï‡ name@gmail.com (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)"/>

      <div class="row">
        <button class="btn g" id="regBtn" type="button">ğŸ†• Î”Î·Î¼Î¹Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±</button>
        <button class="btn" id="regClearBtn" type="button">ğŸ§½ Clear</button>
      </div>

      <div class="mini">Î‘Î½ Î±Ï†Î®ÏƒÎµÎ¹Ï‚ Ï„Î¿ email ÎºÎµÎ½ÏŒ, Î· ÎµÎ³Î³ÏÎ±Ï†Î® Î³Î¯Î½ÎµÏ„Î±Î¹ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¬.</div>
    </div>

    <!-- âœ… Î•ÎÎ¤Î¡Î‘ (ÏƒÏ‰ÏƒÏ„Î® Î¸Î­ÏƒÎ·: Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ .card Î±Î»Î»Î¬ Î­Î¾Ï‰ Î±Ï€ÏŒ loginBox/registerBox) -->
    <p style="font-size:11px;text-align:center;color:rgba(255,255,255,.55);margin-top:12px;">
      Î— ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î´ÎµÎ½ Î±Ï€Î¿Ï„ÎµÎ»ÎµÎ¯ Ï€Î±Î¹Ï‡Î½Î¯Î´Î¹ ÏƒÏ„Î¿Î¹Ï‡Î®Î¼Î±Ï„Î¿Ï‚.
    </p>

    <p style="font-size:12px;text-align:center;margin-top:6px;color:rgba(255,255,255,.75);font-weight:700;">
      ÎœÎµ Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î±Ï€Î¿Î´Î­Ï‡ÎµÏƒÏ„Îµ Ï„Î¿Ï…Ï‚
      <a href="terms.html" target="_blank" style="color:#eaf1ff;text-decoration:underline;">ÎŒÏÎ¿Ï…Ï‚ &amp; Î ÏÎ¿Ï‹Ï€Î¿Î¸Î­ÏƒÎµÎ¹Ï‚</a>
      ÎºÎ±Î¹ Ï„Î¿Ï…Ï‚
      <a href="rules.html" target="_blank" style="color:#eaf1ff;text-decoration:underline;">ÎšÎ±Î½ÏŒÎ½ÎµÏ‚ Î Î±Î¹Ï‡Î½Î¹Î´Î¹Î¿Ï</a>.
    </p>

    <div id="toast" class="pill"></div>
  </div>

<script>
/* =========================
   STORAGE KEYS
========================= */
const KEY_SESSION = 'session';
const KEY_USERS   = 'users';
const KEY_NEXT    = 'nextContestStartISO'; // âœ… Î±Ï€ÏŒ admin

/* =========================
   HELPERS
========================= */
const $ = id => document.getElementById(id);
const R = (k,f)=>{ try{ return JSON.parse(localStorage.getItem(k) || JSON.stringify(f)); } catch { return f; } };
const W = (k,v)=>localStorage.setItem(k, JSON.stringify(v));

function toast(msg){
  const t = $('toast');
  t.textContent = msg;
  t.style.display = 'block';
  clearTimeout(window.__tt);
  window.__tt = setTimeout(()=> t.style.display='none', 2400);
}

function norm(s){ return String(s||'').trim(); }
function normUser(u){ return norm(u).toLowerCase(); }

function isValidEmail(email){
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

/* =========================
   NEXT CONTEST (PRE-LOGIN UI)
========================= */
function fmtDateGreek(isoDate){
  // isoDate: "YYYY-MM-DD"
  const s = String(isoDate||'').trim();
  if(!/^\d{4}-\d{2}-\d{2}$/.test(s)) return null;
  const [yy,mm,dd] = s.split('-');
  return `${dd}/${mm}/${yy}`;
}
function renderNextContest(){
  const iso = String(R(KEY_NEXT,'') || '').trim();
  const pretty = fmtDateGreek(iso);

  if(pretty){
    $('nextText').textContent = `ÎŸ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿Ï‚ Î´Î¹Î±Î³Ï‰Î½Î¹ÏƒÎ¼ÏŒÏ‚ Î±ÏÏ‡Î¯Î¶ÎµÎ¹ ÏƒÏ„Î¹Ï‚ ${pretty}`;
    $('nextSub').textContent = 'ÎœÎ­Ï‡ÏÎ¹ Ï„ÏŒÏ„Îµ Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÎºÎ¬Î½ÎµÎ¹Ï‚ login ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¬.';
  }else{
    $('nextText').textContent = 'ÎŸ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿Ï‚ Î´Î¹Î±Î³Ï‰Î½Î¹ÏƒÎ¼ÏŒÏ‚ Î¸Î± Î±Î½Î±ÎºÎ¿Î¹Î½Ï‰Î¸ÎµÎ¯ ÏƒÏÎ½Ï„Î¿Î¼Î±';
    $('nextSub').textContent = 'ÎŸ admin Î¸Î± Î²Î¬Î»ÎµÎ¹ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î±Ï€ÏŒ Ï„Î¿ Admin Panel.';
  }
}

/* =========================
   USERS
========================= */
function usersAll(){
  const u = R(KEY_USERS, []);
  return Array.isArray(u) ? u : [];
}
function saveUsers(arr){
  W(KEY_USERS, Array.isArray(arr)?arr:[]);
}
function findUser(username){
  const u = normUser(username);
  return usersAll().find(x => normUser(x.username) === u) || null;
}
function upsertUser(user){
  const arr = usersAll();
  const u = normUser(user.username);
  const i = arr.findIndex(x => normUser(x.username) === u);
  if(i >= 0) arr[i] = user;
  else arr.push(user);
  saveUsers(arr);
}

/* =========================
   ADMIN RULE
========================= */
function isAdminCredentials(username, password){
  const U = 'marios';
  const P = '1234';
  return normUser(username) === U && String(password||'') === P;
}

/* =========================
   SESSION
========================= */
function setSession(s){
  W(KEY_SESSION, s);
}
function clearSession(){
  localStorage.removeItem(KEY_SESSION);
}

/* =========================
   UI TABS
========================= */
function showLogin(){
  $('loginBox').classList.remove('hide');
  $('registerBox').classList.add('hide');
  $('tabLogin').className = 'btn a tab';
  $('tabRegister').className = 'btn tab';
}
function showRegister(){
  $('registerBox').classList.remove('hide');
  $('loginBox').classList.add('hide');
  $('tabRegister').className = 'btn a tab';
  $('tabLogin').className = 'btn tab';
}

/* =========================
   ACTIONS
========================= */
function doLogin(){
  const username = norm($('loginUser').value);
  const password = String($('loginPass').value || '');

  if(!username || !password) return toast('Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ username & password');

  // built-in admin
  if(isAdminCredentials(username, password)){
    setSession({ username: normUser(username), isAdmin: true });
    toast('âœ… Admin login');
    return setTimeout(()=> location.href='admin.html', 200);
  }

  // normal user
  const u = findUser(username);
  if(!u) return toast('â›” Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î±Ï…Ï„ÏŒÏ‚ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚');
  if(String(u.password) !== password) return toast('â›” Î›Î¬Î¸Î¿Ï‚ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î±');

  setSession({ username: u.username, isAdmin: !!u.isAdmin });
  toast('âœ… Login');
  setTimeout(()=> location.href='dashboard.html', 200);
}

function doRegister(){
  const username = norm($('regUser').value);
  const password = String($('regPass').value || '');
  const emailRaw = norm($('regEmail').value).toLowerCase();

  if(!username || !password) return toast('Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ username & password');

  if(findUser(username)) return toast('â›” Î¤Î¿ username Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î·');

  if(emailRaw !== '' && !isValidEmail(emailRaw)){
    return toast('Î’Î¬Î»Îµ ÏƒÏ‰ÏƒÏ„ÏŒ email (Î® Î¬Ï†Î·ÏƒÎ­ Ï„Î¿ ÎºÎµÎ½ÏŒ)');
  }

  if(normUser(username) === 'marios'){
    return toast('â›” Î‘Ï…Ï„ÏŒ Ï„Î¿ username ÎµÎ¯Î½Î±Î¹ reserved');
  }

  const user = {
    username: username,
    password: password,
    email: emailRaw || null,
    isAdmin: false,
    createdAt: Date.now()
  };

  upsertUser(user);
  toast('âœ… ÎˆÎ³Î¹Î½Îµ ÎµÎ³Î³ÏÎ±Ï†Î® â€” ÎºÎ¬Î½Îµ Login');
  showLogin();
  $('loginUser').value = user.username;
  $('loginPass').value = '';
}

function clearLoginInputs(){
  $('loginUser').value = '';
  $('loginPass').value = '';
  toast('ğŸ§½ ÎšÎ±Î¸Î±ÏÎ¯ÏƒÏ„Î·ÎºÎµ');
}
function clearRegisterInputs(){
  $('regUser').value = '';
  $('regPass').value = '';
  $('regEmail').value = '';
  toast('ğŸ§½ ÎšÎ±Î¸Î±ÏÎ¯ÏƒÏ„Î·ÎºÎµ');
}

/* =========================
   EVENTS
========================= */
$('tabLogin').onclick = showLogin;
$('tabRegister').onclick = showRegister;

$('loginBtn').onclick = doLogin;
$('clearBtn').onclick = clearLoginInputs;

$('regBtn').onclick = doRegister;
$('regClearBtn').onclick = clearRegisterInputs;

/* =========================
   ON LOAD
========================= */
(function init(){
  // âš ï¸ Î‘Î½ Î´ÎµÎ½ Î¸ÎµÏ‚ Î½Î± ÎºÎ¬Î½ÎµÎ¹ logout ÎºÎ¬Î¸Îµ Ï†Î¿ÏÎ¬, ÏƒÏ‡Î¿Î»Î¯Î±ÏƒÎµ Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Î³ÏÎ±Î¼Î¼Î®:
  clearSession();

  $('loginUser').value = '';
  $('loginPass').value = '';
  $('regUser').value = '';
  $('regPass').value = '';
  $('regEmail').value = '';
  showLogin();

  // âœ… Î´ÎµÎ¯Î¾Îµ "ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿Ï‚ Î´Î¹Î±Î³Ï‰Î½Î¹ÏƒÎ¼ÏŒÏ‚"
  renderNextContest();
})();
<script type="module">
  import { auth, db } from "./firebase.js";
  import {
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  import {
    doc,
    setDoc,
    getDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // ğŸ”§ Î’Î¬Î»Îµ ÎµÎ´Ï Ï„Î± TEST admin credentials (ÏŒ,Ï„Î¹ ÎµÎ¯Ï‡ÎµÏ‚ Î²Î¬Î»ÎµÎ¹ Î³Î¹Î± test)
  const ADMIN_USERNAME = "marios";      // Î¬Î»Î»Î±Î¾Î­ Ï„Î¿ Î±Î½ Î¸ÎµÏ‚
  const ADMIN_PASSWORD = "1234";        // Î¬Î»Î»Î±Î¾Î­ Ï„Î¿ Î±Î½ Î¸ÎµÏ‚

  // ÎœÎµÏ„Î±Ï„ÏÎ­Ï€Î¿Ï…Î¼Îµ username -> email (Î³Î¹Î± Firebase Auth)
  // Ï€.Ï‡. marios -> marios@cmp.local
  function usernameToEmail(username) {
    return `${String(username).trim().toLowerCase()}@cmp.local`;
  }

  // Î’ÏÎµÏ‚ inputs/buttons (Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯ ÏƒÎµ Ï€Î¿Î»Î»Î¬ Ï€Î¹Î¸Î±Î½Î¬ ids)
  const elUser =
    document.getElementById("username") ||
    document.getElementById("loginUsername") ||
    document.querySelector('input[name="username"]') ||
    document.querySelector('input[type="text"]');

  const elPass =
    document.getElementById("password") ||
    document.getElementById("loginPass") ||
    document.querySelector('input[name="password"]') ||
    document.querySelector('input[type="password"]');

  const btnLogin =
    document.getElementById("btnLogin") ||
    document.getElementById("loginBtn") ||
    document.querySelector('[data-action="login"]') ||
    document.querySelector('button[type="submit"]');

  const btnRegister =
    document.getElementById("btnRegister") ||
    document.getElementById("registerBtn") ||
    document.querySelector('[data-action="register"]');

  function requireFields() {
    if (!elUser || !elPass || !btnLogin) {
      alert("Î›ÎµÎ¯Ï€Î¿Ï…Î½ ids ÏƒÏ„Î± Ï€ÎµÎ´Î¯Î±. Î’Î¬Î»Îµ id='username' ÎºÎ±Î¹ id='password' ÎºÎ±Î¹ id='btnLogin' ÏƒÏ„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ login.");
      throw new Error("Missing login form elements");
    }
  }

  // âœ… LOGIN
  btnLogin?.addEventListener("click", async (e) => {
    e.preventDefault();
    alert("CLICK OK");
console.log("CLICK OK");

    requireFields();
    alert("LOGIN CLICK OK");


    const username = elUser.value.trim();
    const password = elPass.value;

    // Admin test login (ÏŒÏ€Ï‰Ï‚ ÎµÎ¯Ï€ÎµÏ‚ ÏŒÏ„Î¹ ÎµÎ¯Ï‡Î±Ï„Îµ Î³Î¹Î± test)
    if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
      window.location.href = "./admin.html";
      return;
    }

    // Customer login via Firebase
    const email = usernameToEmail(username);

    try {
      const cred = await signInWithEmailAndPassword(auth, email, password);

      // Optional: Î­Î»ÎµÎ³Ï‡Î¿Ï‚ role Î±Ï€ÏŒ Firestore (Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹)
      const snap = await getDoc(doc(db, "users", cred.user.uid));
      const role = snap.exists() ? snap.data().role : "user";

      window.location.href = (role === "admin") ? "./admin.html" : "./dashboard.html";
    } catch (err) {
      alert("Î›Î¬Î¸Î¿Ï‚ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Î® Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ user. Î‘Î½ Î´ÎµÎ½ Î­Ï‡ÎµÎ¹Ï‚ ÎºÎ¬Î½ÎµÎ¹ ÎµÎ³Î³ÏÎ±Ï†Î®, Ï€Î¬Ï„Î± Register.");
      console.error(err);
    }
  });

  // âœ… REGISTER (Î±Î½ Î­Ï‡ÎµÎ¹Ï‚ ÎºÎ¿Ï…Î¼Ï€Î¯ register)
  btnRegister?.addEventListener("click", async (e) => {
    e.preventDefault();
    if (!elUser || !elPass) {
      alert("Î’Î¬Î»Îµ id='username' ÎºÎ±Î¹ id='password' ÏƒÏ„Î± Ï€ÎµÎ´Î¯Î±.");
      return;
    }

    const username = elUser.value.trim();
    const password = elPass.value;

    if (!username || !password) {
      alert("Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ username ÎºÎ±Î¹ password.");
      return;
    }

    // Block Î±Î½ ÎºÎ¬Ï€Î¿Î¹Î¿Ï‚ Ï€Î¬ÎµÎ¹ Î½Î± ÎºÎ¬Î½ÎµÎ¹ register Ï‰Ï‚ admin test
    if (username === ADMIN_USERNAME) {
      alert("Î‘Ï…Ï„ÏŒ Ï„Î¿ username ÎµÎ¯Î½Î±Î¹ Î´ÎµÏƒÎ¼ÎµÏ…Î¼Î­Î½Î¿.");
      return;
    }

    const email = usernameToEmail(username);

    try {
      const cred = await createUserWithEmailAndPassword(auth, email, password);

      // Save profile in Firestore
      await setDoc(doc(db, "users", cred.user.uid), {
        username,
        email,
        role: "user",
        createdAt: serverTimestamp()
      });

      alert("Î•Î³Î³ÏÎ±Ï†Î® ÎµÏ€Î¹Ï„Ï…Ï‡Î®Ï‚ âœ…");
      window.location.href = "./dashboard.html";
    } catch (err) {
      alert("Î‘Ï€Î¿Ï„Ï…Ï‡Î¯Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚. ÎœÎ®Ï€Ï‰Ï‚ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î· Î±Ï…Ï„ÏŒ Ï„Î¿ username;");
      console.error(err);
    }
  });
</script>

    
</body>

</html>
