<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Cyprus Match Predict</title>
  <style>
    :root{
      --bg:#070b13;--b:rgba(255,255,255,.12);
      --t:#eaf1ff;--m:rgba(255,255,255,.65);
      --g:rgba(46,204,113,.20);--gb:rgba(46,204,113,.45);
      --a:rgba(241,196,15,.16);--ab:rgba(241,196,15,.45);
      --r:rgba(231,76,60,.14);--rb:rgba(231,76,60,.45);
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    body{
      margin:0;min-height:100vh;padding:18px;color:var(--t);
      background:
        radial-gradient(900px 700px at 20% 0%, rgba(40,110,255,.25), transparent 55%),
        radial-gradient(900px 700px at 80% 10%, rgba(0,255,170,.18), transparent 55%),
        var(--bg);
      display:flex;align-items:center;justify-content:center;
    }
    .card{
      width:min(520px, 100%);
      border:1px solid var(--b);
      border-radius:22px;
      padding:16px;
      background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      box-shadow:0 18px 60px rgba(0,0,0,.55);
    }
    h1{margin:0;font-size:36px}
    .sub{margin-top:6px;color:var(--m);font-weight:700}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
    .pill{
      padding:8px 12px;border:1px solid var(--b);border-radius:999px;
      background:rgba(0,0,0,.25);font-weight:800
    }
    .btn{
      border:1px solid var(--b);background:rgba(255,255,255,.06);color:var(--t);
      padding:10px 12px;border-radius:14px;font-weight:900;cursor:pointer;
      text-decoration:none;display:inline-flex;align-items:center;justify-content:center;gap:8px;
    }
    .g{background:var(--g);border-color:var(--gb)}
    .a{background:var(--a);border-color:var(--ab)}
    .r{background:var(--r);border-color:var(--rb)}
    .box{
      border:1px solid var(--b);border-radius:18px;background:rgba(0,0,0,.18);
      padding:12px;margin-top:12px;
    }
    label{display:block;margin-top:10px;color:var(--m);font-weight:800}
    input{
      width:100%;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--b);
      background:rgba(0,0,0,.25);
      color:var(--t);
      outline:none;
      font-weight:800;
    }
    .mini{color:var(--m);font-weight:750;margin-top:8px}
    .tabs{display:flex;gap:10px;margin-top:12px}
    .tab{flex:1}
    .hide{display:none}
  </style>
</head>

<body>
  <div class="card">
    <div style="text-align:center;margin-bottom:12px;">
      <div style="font-size:18px;font-weight:700;">Cyprus Match Predict</div>
      <div style="font-size:13px;color:#C9A24D;letter-spacing:2px;margin-top:4px;">ğŸ‡¨ğŸ‡¾  C.M.P ğŸ‡¨ğŸ‡¾</div>
    </div>

    <h1>ğŸ” Login</h1>
    <div class="sub">Î’Î¬Î»Îµ username & password. Email (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ) Î¼ÏŒÎ½Î¿ ÏƒÏ„Î·Î½ ÎµÎ³Î³ÏÎ±Ï†Î®.</div>

    <div class="box" id="nextBox">
      <div class="mini" style="font-size:16px;font-weight:900">
        ğŸ“… <span id="nextText">Î•Ï€ÏŒÎ¼ÎµÎ½Î¿Ï‚ Î´Î¹Î±Î³Ï‰Î½Î¹ÏƒÎ¼ÏŒÏ‚: -</span>
      </div>
      <div class="mini" id="nextSub" style="margin-top:6px;opacity:.95">-</div>
    </div>

    <div class="tabs">
      <button class="btn a tab" id="tabLogin" type="button">Î•Î¯ÏƒÎ¿Î´Î¿Ï‚</button>
      <button class="btn tab" id="tabRegister" type="button">Î•Î³Î³ÏÎ±Ï†Î®</button>
    </div>

    <!-- LOGIN -->
    <div class="box" id="loginBox">
     <label>Email</label>
<input id="loginEmail" type="email" placeholder="email@example.com" />

<label>Password</label>
<input id="loginPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />

      <div class="row">
        <button class="btn g" id="loginBtn" type="button">âœ… Login</button>
        <button class="btn" id="clearBtn" type="button">ğŸ§½ Clear</button>
        <div id="loginErr" class="mini" style="color:#ffb3b3;display:none"></div>
      </div>

      <div class="mini">Tip: Î‘Î½ Î²Î»Î­Ï€ÎµÎ¹Ï‚ â€œÎºÏ‰Î´Î¹ÎºÏŒ Î¼ÏŒÎ½Î¿Ï‚ Ï„Î¿Ï…â€, ÎµÎ¯Î½Î±Î¹ autofill Ï„Î¿Ï… Chrome.</div>
    </div>

    <!-- REGISTER -->
    <div class="box hide" id="registerBox">
      <label>Username</label>
      <input id="regUser" autocomplete="username" placeholder="Î´Î¹Î¬Î»ÎµÎ¾Îµ username"/>

      <label>Password</label>
      <input id="regPass" type="password" autocomplete="new-password" placeholder="Î´Î¹Î¬Î»ÎµÎ¾Îµ password"/>

      <label>Email (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)</label>
      <input id="regEmail" type="email" autocomplete="email" placeholder="Ï€.Ï‡ name@gmail.com (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)"/>

      <div class="row">
        <button class="btn g" id="regBtn" type="button">ğŸ†• Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±</button>
        <button class="btn" id="regClearBtn" type="button">ğŸ§½ Clear</button>
        <div id="regErr" class="mini" style="color:#ffb3b3;display:none"></div>
      </div>

      <div class="mini">Î‘Î½ Î±Ï†Î®ÏƒÎµÎ¹Ï‚ Ï„Î¿ email ÎºÎµÎ½ÏŒ, Î· ÎµÎ³Î³ÏÎ±Ï†Î® Î³Î¯Î½ÎµÏ„Î±Î¹ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¬.</div>
    </div>

    <p style="font-size:11px;text-align:center;color:rgba(255,255,255,.55);margin-top:12px;">
      Î— ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î´ÎµÎ½ Î±Ï€Î¿Ï„ÎµÎ»ÎµÎ¯ Ï€Î±Î¹Ï‡Î½Î¯Î´Î¹ ÏƒÏ„Î¿Î¹Ï‡Î®Î¼Î±Ï„Î¿Ï‚.
    </p>

    <p style="font-size:12px;text-align:center;margin-top:6px;color:rgba(255,255,255,.75);font-weight:700;">
      ÎœÎµ Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î±Ï€Î¿Î´Î­Ï‡ÎµÏƒÏ„Îµ Ï„Î¿Ï…Ï‚
      <a href="terms.html" target="_blank" style="color:#eaf1ff;text-decoration:underline;">ÎŒÏÎ¿Ï…Ï‚ &amp; Î ÏÎ¿Ï‹Ï€Î¿Î¸Î­ÏƒÎµÎ¹Ï‚</a>
      ÎºÎ±Î¹ Ï„Î¿Ï…Ï‚
      <a href="rules.html" target="_blank" style="color:#eaf1ff;text-decoration:underline;">ÎšÎ±Î½ÏŒÎ½ÎµÏ‚ Î Î±Î¹Ï‡Î½Î¹Î´Î¹Î¿Ï</a>.
    </p>
  </div>

  <!-- âœ… ÎœÎŸÎÎŸ Î•ÎÎ‘ SCRIPT (MODULE) -->
  <script type="module">
    import { supabase } from "./supabase.js";

    // TEST ÏŒÏ„Î¹ Ï†Î¿ÏÏ„ÏÎ½ÎµÎ¹ Ï„Î¿ supabase.js ÏƒÏ‰ÏƒÏ„Î¬
    console.log("SUPABASE OK:", supabase);

    try {
      /* =========================
         STORAGE KEYS
      ========================= */
      const KEY_SESSION = 'session';
      const KEY_USERS   = 'users';
      const KEY_NEXT    = 'nextContestStartISO';

      /* =========================
         HELPERS
      ========================= */
      const $ = (id) => document.getElementById(id);
      const R = (k,f)=>{ try{ return JSON.parse(localStorage.getItem(k) || JSON.stringify(f)); } catch { return f; } };
      const W = (k,v)=>localStorage.setItem(k, JSON.stringify(v));

      function norm(s){ return String(s||'').trim(); }
      function normUser(u){ return norm(u).toLowerCase(); }
      function isValidEmail(email){
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }

      function setInlineMsg(id, msg){
        const el = $(id);
        if(!el) return;
        const text = String(msg || '').trim();
        if(text){
          el.textContent = text;
          el.style.display = 'block';
        }else{
          el.textContent = '';
          el.style.display = 'none';
        }
      }
      function clearMsgs(){
       _topics('loginErr','');
        setInlineMsg('regErr','');
      }
      function _topics(id,msg){ setInlineMsg(id,msg); } // Î¼Î¹ÎºÏÏŒ alias Î³Î¹Î± Î½Î± Î¼Î·Î½ ÏƒÏ€Î¬ÏƒÎµÎ¹ Ï„Î¯Ï€Î¿Ï„Î±

      /* =========================
         NEXT CONTEST
      ========================= */
      function fmtDateGreek(isoDate){
        const s = String(isoDate||'').trim();
        if(!/^\d{4}-\d{2}-\d{2}$/.test(s)) return null;
        const [yy,mm,dd] = s.split('-');
        return `${dd}/${mm}/${yy}`;
      }
      function renderNextContest(){
        const iso = String(R(KEY_NEXT,'') || '').trim();
        const pretty = fmtDateGreek(iso);

        if(pretty){
          $('nextText').textContent = `ÎŸ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿Ï‚ Î´Î¹Î±Î³Ï‰Î½Î¹ÏƒÎ¼ÏŒÏ‚ Î±ÏÏ‡Î¯Î¶ÎµÎ¹ ÏƒÏ„Î¹Ï‚ ${pretty}`;
          $('nextSub').textContent = 'ÎœÎ­Ï‡ÏÎ¹ Ï„ÏŒÏ„Îµ Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÎºÎ¬Î½ÎµÎ¹Ï‚ login ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¬.';
        }else{
          $('nextText').textContent = 'ÎŸ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿Ï‚ Î´Î¹Î±Î³Ï‰Î½Î¹ÏƒÎ¼ÏŒÏ‚ Î¸Î± Î±Î½Î±ÎºÎ¿Î¹Î½Ï‰Î¸ÎµÎ¯ ÏƒÏÎ½Ï„Î¿Î¼Î±';
          $('nextSub').textContent = 'ÎŸ admin Î¸Î± Î²Î¬Î»ÎµÎ¹ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î±Ï€ÏŒ Ï„Î¿ Admin Panel.';
        }
      }

      /* =========================
         USERS (Ï„Î¿Ï€Î¹ÎºÎ¬ â€” Î³Î¹Î± Ï„ÏÏÎ±)
      ========================= */
      function usersAll(){
        const u = R(KEY_USERS, []);
        return Array.isArray(u) ? u : [];
      }
      function saveUsers(arr){
        W(KEY_USERS, Array.isArray(arr)?arr:[]);
      }
      function findUser(username){
        const u = normUser(username);
        return usersAll().find(x => normUser(x.username) === u) || null;
      }
      function upsertUser(user){
        const arr = usersAll();
        const u = normUser(user.username);
        const i = arr.findIndex(x => normUser(x.username) === u);
        if(i >= 0) arr[i] = user;
        else arr.push(user);
        saveUsers(arr);
      }

      /* =========================
         ADMIN
      ========================= */
      function isAdminCredentials(username, password){
        const U = 'marios';
        const P = '1234';
        return normUser(username) === U && String(password||'') === P;
      }

      /* =========================
         SESSION
      ========================= */
      function setSession(s){ W(KEY_SESSION, s); }

      /* =========================
         UI TABS
      ========================= */
      function showLogin(){
        clearMsgs();
        $('loginBox').classList.remove('hide');
        $('registerBox').classList.add('hide');
        $('tabLogin').className = 'btn a tab';
        $('tabRegister').className = 'btn tab';
      }
      function showRegister(){
        clearMsgs();
        $('registerBox').classList.remove('hide');
        $('loginBox').classList.add('hide');
        $('tabRegister').className = 'btn a tab';
        $('tabLogin').className = 'btn tab';
      }

      /* =========================
         ACTIONS
      ========================= */
      function doLogin(){
        setInlineMsg('loginErr','');

        const username = norm($('loginUser').value);
        const password = String($('loginPass').value || '');

        if(!username || !password){
          return setInlineMsg('loginErr','Î“ÏÎ¬ÏˆÎµ username ÎºÎ±Î¹ password.');
        }

        if(isAdminCredentials(username, password)){
          setSession({ username: normUser(username), isAdmin: true });
          return setTimeout(()=> location.href='admin.html', 200);
        }

        const u = findUser(username);
        if(!u){
          return setInlineMsg('loginErr','Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ username.');
        }

        if(String(u.password) !== password){
          return setInlineMsg('loginErr','Î›Î¬Î¸Î¿Ï‚ password. Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¾Î±Î½Î¬.');
        }

        setSession({ username: u.username, isAdmin: !!u.isAdmin });
        setTimeout(()=> location.href='dashboard.html', 200);
      }

      function doRegister(){
        setInlineMsg('regErr','');

        const username = norm($('regUser').value);
        const password = String($('regPass').value || '');
        const emailRaw = norm($('regEmail').value).toLowerCase();

        if(!username || !password){
          return setInlineMsg('regErr','Î’Î¬Î»Îµ username ÎºÎ±Î¹ password Î³Î¹Î± ÎµÎ³Î³ÏÎ±Ï†Î®.');
        }

        if(findUser(username)){
          return setInlineMsg('regErr','Î‘Ï…Ï„ÏŒ Ï„Î¿ username ÎµÎ¯Î½Î±Î¹ Î®Î´Î· Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿.');
        }

        if(emailRaw !== '' && !isValidEmail(emailRaw)){
          return setInlineMsg('regErr','Î¤Î¿ email Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ¿.');
        }

        if(normUser(username) === 'marios'){
          return setInlineMsg('regErr','Î¤Î¿ username "marios" ÎµÎ¯Î½Î±Î¹ Î´ÎµÏƒÎ¼ÎµÏ…Î¼Î­Î½Î¿ Î³Î¹Î± Ï„Î¿Î½ admin.');
        }

        const user = {
          username,
          password,
          email: emailRaw || null,
          isAdmin: false,
          createdAt: Date.now()
        };

        upsertUser(user);

        showLogin();
        $('loginUser').value = user.username;
        $('loginPass').value = '';
        setInlineMsg('loginErr','âœ… ÎˆÎ³Î¹Î½Îµ ÎµÎ³Î³ÏÎ±Ï†Î®! Î¤ÏÏÎ± ÎºÎ¬Î½Îµ login.');
      }

      function clearLoginInputs(){
        $('loginUser').value = '';
        $('loginPass').value = '';
        setInlineMsg('loginErr','');
      }

      function clearRegisterInputs(){
        $('regUser').value = '';
        $('regPass').value = '';
        $('regEmail').value = '';
        setInlineMsg('regErr','');
      }

      /* =========================
         BIND EVENTS (Î¼Îµ Î­Î»ÎµÎ³Ï‡Î¿)
      ========================= */
      const requiredIds = [
        'tabLogin','tabRegister','loginBtn','clearBtn','regBtn','regClearBtn',
        'loginBox','registerBox','nextText','nextSub',
        'loginUser','loginPass','regUser','regPass','regEmail',
        'loginErr','regErr'
      ];
      for(const id of requiredIds){
        if(!$(id)) throw new Error("Missing element id: " + id);
      }

      $('tabLogin').addEventListener('click', showLogin);
      $('tabRegister').addEventListener('click', showRegister);
      $('loginBtn').addEventListener('click', doLogin);
      $('clearBtn').addEventListener('click', clearLoginInputs);
      $('regBtn').addEventListener('click', doRegister);
      $('regClearBtn').addEventListener('click', clearRegisterInputs);

      /* =========================
         INIT
      ========================= */
      const sess = R(KEY_SESSION, null);
      if (sess && sess.username) {
        location.href = sess.isAdmin ? 'admin.html' : 'dashboard.html';
      } else {
        showLogin();
        renderNextContest();
      }

    } catch (err) {
      console.error("JS ERROR:", err);
      document.body.insertAdjacentHTML(
        "afterbegin",
        `<div style="position:fixed;top:12px;left:12px;right:12px;z-index:99999;
          background:rgba(231,76,60,.18);border:1px solid rgba(231,76,60,.55);
          color:#ffd3d3;padding:10px 12px;border-radius:14px;font-weight:900">
          JS ERROR: ${String(err && err.message ? err.message : err)}
        </div>`
      );
    }
  </script>

</body>
</html>

