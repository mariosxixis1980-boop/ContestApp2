<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Cyprus Match Predict</title>
  <style>
    :root{
      --bg:#070b13;--b:rgba(255,255,255,.12);
      --t:#eaf1ff;--m:rgba(255,255,255,.65);
      --g:rgba(46,204,113,.20);--gb:rgba(46,204,113,.45);
      --a:rgba(241,196,15,.16);--ab:rgba(241,196,15,.45);
      --r:rgba(231,76,60,.14);--rb:rgba(231,76,60,.45);
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    body{
      margin:0;min-height:100vh;padding:18px;color:var(--t);
      background:
        radial-gradient(900px 700px at 20% 0%, rgba(40,110,255,.25), transparent 55%),
        radial-gradient(900px 700px at 80% 10%, rgba(0,255,170,.18), transparent 55%),
        var(--bg);
      display:flex;align-items:center;justify-content:center;
    }
    .card{
      width:min(520px, 100%);
      border:1px solid var(--b);
      border-radius:22px;
      padding:16px;
      background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      box-shadow:0 18px 60px rgba(0,0,0,.55);
    }
    h1{margin:0;font-size:36px}
    .sub{margin-top:6px;color:var(--m);font-weight:700}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
    .btn{
      border:1px solid var(--b);background:rgba(255,255,255,.06);color:var(--t);
      padding:10px 12px;border-radius:14px;font-weight:900;cursor:pointer;
      text-decoration:none;display:inline-flex;align-items:center;justify-content:center;gap:8px;
    }
    .g{background:var(--g);border-color:var(--gb)}
    .a{background:var(--a);border-color:var(--ab)}
    .box{
      border:1px solid var(--b);border-radius:18px;background:rgba(0,0,0,.18);
      padding:12px;margin-top:12px;
    }
    label{display:block;margin-top:10px;color:var(--m);font-weight:800}
    input{
      width:100%;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--b);
      background:rgba(0,0,0,.25);
      color:var(--t);
      outline:none;
      font-weight:800;
    }
    .mini{color:var(--m);font-weight:750;margin-top:8px}
    .tabs{display:flex;gap:10px;margin-top:12px}
    .tab{flex:1}
    .hide{display:none}
  </style>
</head>

<body>
  <div class="card">
    <div style="text-align:center;margin-bottom:12px;">
      <div style="font-size:18px;font-weight:700;">Cyprus Match Predict</div>
      <div style="font-size:13px;color:#C9A24D;letter-spacing:2px;margin-top:4px;">ğŸ‡¨ğŸ‡¾  C.M.P ğŸ‡¨ğŸ‡¾</div>
    </div>

    <h1>ğŸ” Login</h1>
    <div class="sub">Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Email &amp; Password (Supabase).</div>

    <div class="tabs">
      <button class="btn a tab" id="tabLogin" type="button">Î•Î¯ÏƒÎ¿Î´Î¿Ï‚</button>
      <button class="btn tab" id="tabRegister" type="button">Î•Î³Î³ÏÎ±Ï†Î®</button>
    </div>

    <!-- LOGIN -->
    <div class="box" id="loginBox">
      <label>Email</label>
      <input id="loginEmail" type="email" autocomplete="email" placeholder="email@example.com" />

      <label>Password</label>
      <input id="loginPass" type="password" autocomplete="current-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />

      <div class="row">
        <button class="btn g" id="loginBtn" type="button">âœ… Login</button>
        <button class="btn" id="clearBtn" type="button">ğŸ§½ Clear</button>
        <div id="loginErr" class="mini" style="color:#ffb3b3;display:none"></div>
      </div>

      <div class="mini">Tip: Î‘Î½ Î²Î»Î­Ï€ÎµÎ¹Ï‚ â€œÎºÏ‰Î´Î¹ÎºÏŒ Î¼ÏŒÎ½Î¿Ï‚ Ï„Î¿Ï…â€, ÎµÎ¯Î½Î±Î¹ autofill Ï„Î¿Ï… Chrome.</div>
    </div>

    <!-- REGISTER -->
    <div class="box hide" id="registerBox">
      <label>Username</label>
      <input id="regUser" autocomplete="username" placeholder="Î´Î¹Î¬Î»ÎµÎ¾Îµ username"/>

      <label>Email</label>
      <input id="regEmail" type="email" autocomplete="email" placeholder="name@gmail.com"/>

      <label>Password</label>
      <input id="regPass" type="password" autocomplete="new-password" placeholder="Î´Î¹Î¬Î»ÎµÎ¾Îµ password (6+ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚)"/>

      <div class="row">
        <button class="btn g" id="regBtn" type="button">ğŸ†• Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±</button>
        <button class="btn" id="regClearBtn" type="button">ğŸ§½ Clear</button>
        <div id="regErr" class="mini" style="color:#ffb3b3;display:none"></div>
      </div>

      <div class="mini">Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: Î‘Î½ Î­Ï‡ÎµÎ¹Ï‚ ÎµÎ½ÎµÏÎ³ÏŒ email confirmation ÏƒÏ„Î¿ Supabase, Î¸Î± Î¶Î·Ï„Î®ÏƒÎµÎ¹ ÎµÏ€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· email.</div>
    </div>

    <p style="font-size:11px;text-align:center;color:rgba(255,255,255,.55);margin-top:12px;">
      Î— ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î´ÎµÎ½ Î±Ï€Î¿Ï„ÎµÎ»ÎµÎ¯ Ï€Î±Î¹Ï‡Î½Î¯Î´Î¹ ÏƒÏ„Î¿Î¹Ï‡Î®Î¼Î±Ï„Î¿Ï‚.
    </p>

    <p style="font-size:12px;text-align:center;margin-top:6px;color:rgba(255,255,255,.75);font-weight:700;">
      ÎœÎµ Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î±Ï€Î¿Î´Î­Ï‡ÎµÏƒÏ„Îµ Ï„Î¿Ï…Ï‚
      <a href="terms.html" target="_blank" style="color:#eaf1ff;text-decoration:underline;">ÎŒÏÎ¿Ï…Ï‚ &amp; Î ÏÎ¿Ï‹Ï€Î¿Î¸Î­ÏƒÎµÎ¹Ï‚</a>
      ÎºÎ±Î¹ Ï„Î¿Ï…Ï‚
      <a href="rules.html" target="_blank" style="color:#eaf1ff;text-decoration:underline;">ÎšÎ±Î½ÏŒÎ½ÎµÏ‚ Î Î±Î¹Ï‡Î½Î¹Î´Î¹Î¿Ï</a>.
    </p>
  </div>

  <script type="module">
    import { supabase } from "./supabase.js";

    // âœ… Î’Î¬Î»Îµ ÎµÎ´Ï Ï„Î¿ admin email ÏƒÎ¿Ï… (Ï„Î¿ Î¯Î´Î¹Î¿ Ï€Î¿Ï… Î­Ï‡ÎµÎ¹Ï‚ ÏƒÏ„Î¿ Supabase account)
    const ADMIN_EMAIL = "mariosxixis1980@gmail.com";

    const $ = (id) => document.getElementById(id);

    function norm(s){ return String(s || "").trim(); }
    function isValidEmail(email){
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
    function setInlineMsg(id, msg){
      const el = $(id);
      if(!el) return;
      const text = String(msg || "").trim();
      if(text){
        el.textContent = text;
        el.style.display = "block";
      } else {
        el.textContent = "";
        el.style.display = "none";
      }
    }
    function clearMsgs(){
      setInlineMsg("loginErr", "");
      setInlineMsg("regErr", "");
    }

    function showLogin(){
      clearMsgs();
      $("loginBox").classList.remove("hide");
      $("registerBox").classList.add("hide");
      $("tabLogin").className = "btn a tab";
      $("tabRegister").className = "btn tab";
    }

    function showRegister(){
      clearMsgs();
      $("registerBox").classList.remove("hide");
      $("loginBox").classList.add("hide");
      $("tabRegister").className = "btn a tab";
      $("tabLogin").className = "btn tab";
    }

    async function doLogin(){
      clearMsgs();

      const email = norm($("loginEmail").value).toLowerCase();
      const password = String($("loginPass").value || "");

      if(!email || !password) return setInlineMsg("loginErr", "Î“ÏÎ¬ÏˆÎµ email ÎºÎ±Î¹ password.");
      if(!isValidEmail(email)) return setInlineMsg("loginErr", "Î¤Î¿ email Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ¿.");

      const { data, error } = await supabase.auth.signInWithPassword({ email, password });

      if(error){
        return setInlineMsg("loginErr", "Î›Î¬Î¸Î¿Ï‚ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Î® Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚.");
      }

      const userEmail = (data?.user?.email || "").toLowerCase();
      if(userEmail === ADMIN_EMAIL.toLowerCase()){
        location.href = "admin.html";
      } else {
        location.href = "dashboard.html";
      }
    }

    async function doRegister(){
      clearMsgs();

      const username = norm($("regUser").value);
      const email = norm($("regEmail").value).toLowerCase();
      const password = String($("regPass").value || "");

      if(!username) return setInlineMsg("regErr", "Î’Î¬Î»Îµ username.");
      if(!email || !password) return setInlineMsg("regErr", "Î’Î¬Î»Îµ email ÎºÎ±Î¹ password.");
      if(!isValidEmail(email)) return setInlineMsg("regErr", "Î¤Î¿ email Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ¿.");
      if(password.length < 6) return setInlineMsg("regErr", "Î¤Î¿ password Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ 6+ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚.");

      const { error } = await supabase.auth.signUp({
        email,
        password,
        options: {
          data: { username }
        }
      });

      if(error){
        return setInlineMsg("regErr", "Î”ÎµÎ½ Î­Î³Î¹Î½Îµ ÎµÎ³Î³ÏÎ±Ï†Î®. Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¬Î»Î»Î¿ email Î® password.");
      }

      setInlineMsg("regErr", "âœ… ÎˆÎ³Î¹Î½Îµ ÎµÎ³Î³ÏÎ±Ï†Î®! Î¤ÏÏÎ± ÎºÎ¬Î½Îµ login (Î® Î­Î»ÎµÎ³Î¾Îµ email Î³Î¹Î± confirmation).");
      showLogin();
      $("loginEmail").value = email;
      $("loginPass").value = "";
    }

    function clearLoginInputs(){
      $("loginEmail").value = "";
      $("loginPass").value = "";
      setInlineMsg("loginErr", "");
    }

    function clearRegisterInputs(){
      $("regUser").value = "";
      $("regEmail").value = "";
      $("regPass").value = "";
      setInlineMsg("regErr", "");
    }

    // âœ… ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÏŒÏ„Î¹ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÏŒÎ»Î± Ï„Î± IDs (Î±Î½ Î»ÎµÎ¯Ï€ÎµÎ¹ ÎºÎ¬Ï„Î¹, Î½Î± Ï„Î¿ Î´ÎµÎ¹Ï‚ ÏƒÏ„Î¿ Console)
    const requiredIds = [
      "tabLogin","tabRegister","loginBtn","clearBtn","regBtn","regClearBtn",
      "loginBox","registerBox","loginEmail","loginPass","regUser","regEmail","regPass",
      "loginErr","regErr"
    ];
    for(const id of requiredIds){
      if(!$(id)) throw new Error("Missing element id: " + id);
    }

    // Bind events
    $("tabLogin").addEventListener("click", showLogin);
    $("tabRegister").addEventListener("click", showRegister);
    $("loginBtn").addEventListener("click", doLogin);
    $("clearBtn").addEventListener("click", clearLoginInputs);
    $("regBtn").addEventListener("click", doRegister);
    $("regClearBtn").addEventListener("click", clearRegisterInputs);

    // Init: Î±Î½ ÎµÎ¯Î½Î±Î¹ Î®Î´Î· logged in -> redirect
    try{
      const { data } = await supabase.auth.getSession();
      const session = data?.session;

      if(session?.user?.email){
        const e = session.user.email.toLowerCase();
        location.href = (e === ADMIN_EMAIL.toLowerCase()) ? "admin.html" : "dashboard.html";
      } else {
        showLogin();
      }
    } catch (err){
      console.error("INIT ERROR:", err);
      showLogin();
    }
  </script>

</body>
</html>
